<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="static/images/LT-tab.svg">
<title>Lausanne Transportation</title>
<meta name="description" content="Lausanne Transportation">
<meta name="keywords" content="Lausanne, Transportation, Map, Network, Lines, Stops, History, Stories">
<meta name="author" content="Antonin Faure">
<meta name="author" content="Lena Vogel">
<meta name="author" content="Salma Ed-dahabi">

<link rel="stylesheet" href="https://unpkg.com/maptalks/dist/maptalks.css">
<link rel="stylesheet" href="static/assets/style.css">

<script type="text/javascript" src="https://unpkg.com/three@0.138.0/build/three.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/maptalks/dist/maptalks.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/maptalks.three/dist/maptalks.three.js"></script>
<script src="https://cdn.jsdelivr.net/npm/maptalks.heatmap@0.6.2/dist/maptalks.heatmap.min.js"></script>

<script src="https://cdn.plot.ly/plotly-2.20.0.min.js" charset="utf-8"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700" rel="stylesheet">

<body>
  <img id="logo" src="./images/LT-tab.png" alt="Lausanne Transportation Logo">
  <div id="map"></div>
  <div id="overlay">
    <div id="sections">
      <div class="sections-scroller">
        <!-- SECTION 1 -->
        <div id="section1" class="section">
          <h2>Welcome to Lausanne Transportation</h2>
          <p>Welcome to our journey through the transportation network of Lausanne. As you embark on this interactive
            exploration, you'll discover the dynamic and interconnected web that keeps Lausanne moving.</p>
          <h3>The Network Map</h3>
          <p>Behold the mesmerizing sight of Lausanne's transportation network spread before you. In this 3D map, every
            line represents a vital artery that courses through the city, connecting neighborhoods, institutions, and
            communities. Watch as buses and metros traverse the lines, bringing life and energy to the city's streets.
          </p>
          <p>Lausanne's commitment to accessibility and sustainability is evident in the intricate network of lines that
            reach from the bustling city center to the tranquil outskirts. This transportation system is the lifeblood
            that fuels the city's growth and fosters seamless connectivity for residents and visitors alike.</p>
          <p>As you explore the map, take note of the different routes and lines that crisscross Lausanne. Each line has
            its own story, its own purpose in serving the people who rely on it daily. From the students heading to
            school, to the employees commuting to work, to the families on their way to the park - these lines are the
            threads that weave together the fabric of Lausanne's vibrant transportation network.</p>
          <p>Whether you are a daily commuter, an urban explorer, or simply a curious learner, we invite you to join us
            on this journey of discovery. Gain a deeper understanding and appreciation for the transportation network
            that keeps Lausanne in motion. Let's dive into the specifics of different lines, uncover their history, and
            explore their impact on the city's life and growth.</p>
          <p>Get ready to witness the magic of Lausanne's transportation network unfold before your eyes. Let us embark
            on this fascinating journey together and discover what makes this city move!</p>
        </div>



        <!-- SECTION 2 -->
        <div id="section2" class="section">
          <h2>The Lines: Connecting Points and People</h2>
          <p>Every line in Lausanne's transportation system has its own story and performance. In this section, we
            present a unique opportunity to discover the top-performing lines through an exciting championship-style
            ranking.</p>

          <h3>Interactive Line Performance Ranking</h3>

          <p>The ranking table provides an overview of the top-performing lines based on mean arrival and departure
            delays. Each line is assigned a rank, allowing you to easily identify the best-performing lines for the
            selected day.</p>
          <p>But the competition doesn't end there! By clicking on a row corresponding to a line in the table, the
            selected line will be highlighted on the 3D map. Visualize the routes and visualize the champions in action!
          </p>
          <p>Embark on this journey of line performance exploration and discover which lines come out on top in
            Lausanne's transportation system. Will your favorite line take the crown? Let the competition begin!</p>



          <div>
            <div class="slider-container">
              <label for="daySelect-2">Day:</label>
              <input type="range" min="0" max="6" step="1" id="daySelect-2" list="slider-labels-2">
              <div id="slider-labels-2" class="slider-labels">
                <span>Mon</span>
                <span>Tue</span>
                <span>Wed</span>
                <span>Thu</span>
                <span>Fri</span>
                <span>Sat</span>
                <span>Sun</span>
              </div>
            </div>

            <label for="sortSelect">Sort By:</label>
            <select id="sortSelect">
              <option value="arrival_delay_rank">Median Arrival Delay</option>
              <option value="departure_delay_rank">Median Departure Delay</option>
            </select>

            <table id="championshipTable">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Line</th>
                  <th>Median Arrival Delay (sec)</th>
                  <th>Median Departure Delay (sec)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>


        </div>

        <!-- SECTION 3 -->
        <div id="section3" class="section">
          <h2>Exploring Line Performance: Delays and Stops</h2>
          <p>Each line on the transportation map represents a vital connection between places, people, and stories. In
            this section, we dive deeper into the performance of specific lines in Lausanne's transportation system. By
            analyzing the median arrival and departure delays at each stop along the selected line, we gain insights
            into its punctuality and efficiency.</p>

          <p>By exploring the line performance through this interactive visualization, you can gain insights into the
            punctuality and reliability of specific lines in Lausanne's transportation system. Discover how delays vary
            at different stops, identify potential bottlenecks, and make informed decisions about your travel routes
            within the city.</p>

          <h3>Interactive Line Visualization</h3>
          <p>Using our interactive 3D map, you can select a specific day of the week and choose a line from the dropdown
            menu. The map will display the selected line with its associated stops, represented as a 3D histogram. The
            height of each histogram bar corresponds to the median arrival and departure delays at that particular stop.
          </p>
          <div class="slider-container">
            <label for="daySelect">Day:</label>
            <input type="range" min="0" max="6" step="1" id="daySelect">
            <div id="daySelectLabels" class="slider-labels">
              <span>Mon</span>
              <span>Tue</span>
              <span>Wed</span>
              <span>Thu</span>
              <span>Fri</span>
              <span>Sat</span>
              <span>Sun</span>
            </div>
          </div>

          <div class="select-container">
            <label for="lineSelect">Line:</label>
            <select id="lineSelect"></select>
          </div>

          <p>Additionally, you can find below a bar plot that provides a summarized view of the
            median arrival and departure delays for each stop in order along the selected line. This plot allows for a
            quick
            comparison of delays across different stops, providing a comprehensive overview of the line's performance.
          </p>
          <div id="line-delays-plot" style="width: 50%;"></div>


        </div>

        <!-- SECTION 4 -->
        <div id="section4" class="section">
          <h2>The Stops: Where Journeys Begin and End</h2>
          <p>The heart of any transportation system lies in its stops - the places where journeys begin and end. They
            are the nodes that bind the network together, serving as vital connection points for commuters and
            travelers. In Lausanne, these stops are vibrant hubs of activity, facilitating smooth and efficient movement
            across the city.</p>

          <h3>Exploring the Stops</h3>
          <p>In this section, we invite you to delve into the stops of Lausanne's transportation network and discover
            their significance. Using an interactive 3D map, you can visualize the distribution and density of stops
            throughout the city. The map provides a bird's-eye view of the interconnected web of stops, highlighting the
            key locations and their connectivity.</p>
          <p>Furthermore, we present a 3D histogram that represents the activity levels at different stops. This
            histogram offers valuable insights into the intensity of passenger activity, helping you identify the
            busiest hubs and popular destinations within the city. It showcases the ebb and flow of commuters, students,
            residents, and visitors as they navigate through Lausanne's transportation network.</p>

          <div class="slider-container">
            <label for="daySelect-stops">Day:</label>
            <input type="range" min="0" max="6" step="1" id="daySelect-stops">
            <div class="slider-labels">
              <span>Mon</span>
              <span>Tue</span>
              <span>Wed</span>
              <span>Thu</span>
              <span>Fri</span>
              <span>Sat</span>
              <span>Sun</span>
            </div>
          </div>

          <div class="slider-container">
            <label for="hourSelect-stops">Hour:</label>
            <input type="range" min="0" max="23" step="1" id="hourSelect-stops">
            <div class="slider-labels">
              <span>0h</span>
              <span>23h</span>
            </div>
          </div>

          <div class="heatmap-button">
            <label>
              <input type="checkbox" id="heatmapEnable"><span>Enable Heatmap</span>
            </label>
          </div>

          <p>Additionally, you have the option to enable a heatmap that visualizes the activity patterns at stops. By
            activating the heatmap, you can observe the areas with the highest concentration of passenger interactions,
            providing valuable insights into the dynamics of transportation usage in Lausanne.</p>
          <p>Through this exploration of stops and their activity, you will gain a deeper understanding of the bustling
            nodes that bring Lausanne's transportation system to life. Discover where journeys begin and end, where
            people gather and disperse, and how these stops contribute to the overall functioning and vitality of the
            city.</p>
        </div>

        <!-- SECTION 5 -->
        <div id="section5" class="section">
          <h2>EPFL Students' Perception on Lausanne's Transportation</h2>
          <p>Understanding the views of EPFL students on local transportation was a vital part of our research. We
            conducted a comprehensive survey, which saw participation from 150 students, to gather their opinions.</p>
          <h3>Survey Findings</h3>
          <p>Our findings suggest that the majority of students are satisfied with Lausanne's transportation system.
            Here are some key insights from the survey:</p>

          <canvas id="myChart1" style="width:100%;"></canvas>
          <canvas id="myChart2" style="width:100%;"></canvas>
          <canvas id="myChart3" style="width:100%;"></canvas>

          <p>These findings reflect the positive perception and satisfaction of EPFL students towards Lausanne's
            transportation system. The results validate the efforts put into providing efficient and reliable public
            transport options for the community.</p>
        </div>

        <!-- SECTION 6 -->
        <div id="section6" class="section">
          <h2>About the Project</h2>
          <p>This project is an initiative by a team of dedicated students from the COM-480 Data Visualization course at
            EPFL. Our goal was to provide meaningful insights into various aspects of Lausanne's transportation system
            and enhance understanding and awareness among residents and visitors.</p>
          <p>For more details, or if you wish to contribute, please visit our <a
              href="https://github.com/com-480-data-visualization/project-2023-the-vizards" target="_blank">Project's
              GitHub</a> page.</p>
          <h3>Project Goals</h3>
          <p>The main objectives of our project were:</p>
          <ul>
            <li>To analyze and visualize the transportation network of Lausanne: We aimed to create an interactive and
              informative visualization that would allow users to explore the city's public transport system, including
              the lines, stops, and their characteristics.</li>
            <li>To highlight the importance and impact of public transportation: We wanted to showcase how Lausanne's
              transportation network plays a crucial role in connecting people, places, and stories. By emphasizing its
              significance, we aimed to encourage the use of public transport and promote sustainable mobility options.
            </li>
            <li>To provide insights based on data analysis: By analyzing transportation data, we aimed to uncover
              patterns, trends, and performance metrics of different lines and stops. This information would help users
              make informed decisions about their travel routes and understand the reliability and punctuality of the
              system.</li>
            <li>To gather feedback and perceptions from EPFL students: We conducted a survey to collect opinions and
              experiences of EPFL students regarding Lausanne's transportation system. This feedback provided valuable
              insights and helped us gauge the satisfaction levels and areas of improvement.</li>
            <li>To foster collaboration and contribution: Through our project, we aimed to engage the community and
              encourage contributions and feedback. We believe that collaboration is essential for continuous
              improvement and innovation in transportation systems.</li>
          </ul>
          <h3>Meet the Team</h3>
          <ul>
            <li><a href="https://github.com/antoninfaure" target="_blank">Antonin Faure</a> - Master Data Science</li>
            <li><a href="https://github.com/lvogelEPFL" target="_blank">Lena Vogel</a> - Master Life Science</li>
            <li><a href="https://github.com/salma-ed" target="_blank">Salma Ed-Dahabi</a> - Master Communication Systems
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div id="controls">
      <button id="prevButton" class="control-button" disabled>Previous</button>
      <button id="nextButton" class="control-button">Next</button>
    </div>
  </div>

  <div class="doors">
    <div class="door door-left"></div>
    <div class="door door-right"></div>
  </div>

  <script src="static/assets/utils.js"></script>
  <script src="static/assets/sections.js"></script>
  <script src="static/assets/survey.js"></script>
  <script>

    const MAX_MOBILE_WIDTH = 1500;

    var map = new maptalks.Map('map', {
      center: window.innerWidth > MAX_MOBILE_WIDTH ? [6.6736, 46.5409] : [6.6322, 46.5192],
      zoom: 13,
      pitch: 40,
      bearing: 0,
      baseLayer: new maptalks.TileLayer('base', {
        urlTemplate: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
        subdomains: ["a", "b", "c", "d"],
        attribution: '&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>'
      })
    });

    var threeLayer = new maptalks.ThreeLayer('t');
    var heatmapLayer = new maptalks.HeatLayer('heatmap', [], {
      'radius': 32,
      'blur': 60
    });
    var stopsLayer = new maptalks.ThreeLayer('stops');

    threeLayer.prepareToDraw = function (gl, scene, camera) {
      var light = new THREE.DirectionalLight(0xffffff);
      light.position.set(0, -10, 10).normalize();
      scene.add(light);
      scene.add(new THREE.AmbientLight('#fff', 0.5));

      loadLines().then(function (data) {
        const linesMesh = data.linesMesh;
        const displayableLines = data.displayableLines;

        loadDelays().then(function (data) {
          const delaysMesh = data.delaysMesh;
          const linesWithDelays = data.linesWithDelays;
          const delaysData = data.delaysData;

          const optionsLines = createLineSelect(displayableLines, linesWithDelays);

          const lineSelect = document.getElementById('lineSelect');
          const daySelect = document.getElementById('daySelect');

          lineSelect.addEventListener('change', function () {
            updateVisibilityLine(linesMesh, delaysMesh)
            plotLineDelays(delaysData, optionsLines)
            var selectedOption = this.options[this.selectedIndex];
            this.style.backgroundColor = selectedOption.style.backgroundColor;
          });
          daySelect.addEventListener('input', function () {
            updateVisibilityLine(linesMesh, delaysMesh)
            plotLineDelays(delaysData, optionsLines)
          });

          loadChampionship(linesMesh, optionsLines).then(function () {

            loadStops().then(function (data) {
              const stopsData = data.stopsData;
              const stopsMesh = data.stopsMesh;

              const hourSelect = document.getElementById('hourSelect-stops');
              const daySelect = document.getElementById('daySelect-stops');

              var light = new THREE.DirectionalLight(0xffffff);
              light.position.set(0, -10, 10).normalize();

              stopsLayer.getScene().add(light);
              stopsLayer.getScene().add(new THREE.AmbientLight('#fff', 0.5));

              hourSelect.addEventListener('input', function () {
                updateHeatmap(stopsData)
                showStops(stopsMesh)
              });

              daySelect.addEventListener('input', function () {
                updateHeatmap(stopsData)
                showStops(stopsMesh)
              });

              document.getElementById('heatmapEnable').addEventListener('change', function () {
                updateHeatmap(stopsData)
              });

              createSectionsController(linesMesh, delaysMesh, optionsLines, delaysData, stopsMesh, stopsData);
              openDoors();
            })
          })
        })
      });

    };

    map.addLayer(threeLayer);
    map.addLayer(heatmapLayer);
    map.addLayer(stopsLayer);

    // TOOL TIP //
    let tooltip = document.createElement('div');
    tooltip.id = 'tooltip';
    tooltip.style.position = 'absolute';
    tooltip.style.backgroundColor = 'white';
    tooltip.style.border = '1px solid black';
    tooltip.style.padding = '10px 20px';
    tooltip.style.display = 'none'; // Hide the tooltip by default
    tooltip.style.pointerEvents = 'none'; // Make sure the tooltip doesn't block mouse events on the map
    tooltip.style.borderRadius = '10px';
    tooltip.style.boxShadow = '2px 2px 6px 0px rgba(0,0,0,0.3)';
    tooltip.style.marginLeft = '10px';
    tooltip.style.marginTop = '10px';
    document.body.appendChild(tooltip);

    function showTooltip(e) {
      let intersected = threeLayer.identify(e.coordinate);
      let intersectedStops = stopsLayer.identify(e.coordinate);

      if (intersectedStops && intersectedStops.length > 0) { // STOPS INTERSECTIONS

        intersectedOptions = intersectedStops[0].options

        if ('activity' in intersectedOptions) {
          tooltip.innerHTML = `<b>${intersectedOptions.stop_name}</b><br>${intersectedOptions.activity} transactions on average`;

        } else {
          // Hide tooltip if not hovering over a mesh
          tooltip.style.display = 'none';
          return
        }
      } else if (intersected && intersected.length > 0) { // OTHER INTERSECTIONS

        intersectedOptions = intersected[0].options

        if ('arrival_delay' in intersectedOptions) {
          tooltip.innerHTML = `<b>${intersectedOptions.stop_name}</b><br>Median arrival delay: ${intersectedOptions.arrival_delay}s`;
        } else if ('departure_delay' in intersectedOptions) {
          tooltip.innerHTML = `<b>${intersectedOptions.stop_name}</b><br>Median departure delay: ${intersectedOptions.departure_delay}s`;
        } else if ('line_name' in intersectedOptions) {
          tooltip.innerHTML = `<b>Line ${intersectedOptions.line_name}</b>`;
        } else {
          // Hide tooltip if not hovering over a mesh
          tooltip.style.display = 'none';
          return
        }

      } else {
        // Hide tooltip if not hovering over a mesh
        tooltip.style.display = 'none';
        return
      }

      // Show  tooltip
      tooltip.style.display = 'block';
      tooltip.style.left = e.containerPoint.x + 'px';
      tooltip.style.top = e.containerPoint.y + 'px';

    }

    map.on('mousemove', showTooltip);
    map.on('touchmove', showTooltip);

  </script>
</body>

</html>